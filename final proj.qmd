---
title: "FinalProjRBootcamp"
author: "Caroline Ponticelli"
format: html
editor: visual
execute: 
  cache: true
  echo: false
---

## Quarto

Quarto enables you to weave together content and executable code into a finished document. To learn more about Quarto see <https://quarto.org>.

## Running Code

When you click the **Render** button a document will be generated that includes both content and the output of embedded code. You can embed code like this:

```{r}
library(gtsummary)
library(tidyverse)
library(here)
library(scales)
library(readr)
library(dplyr)
library(readxl)
library(renv)
library(lubridate)
library(broom)


adopt <- read_excel(here::here("Finalproj", "data", "shelterreportdata.xlsx"))
```

Only data for dogs and certain variables.

```{r}
columns_to_drop <- c(3, 6, 8, 10, 11, 13, 15, 17, 19, 21, 23, 25, 27, 29, 31, 33, 35)

# Drop the specified columns to make a data set with just dog data
adopt_subset <- adopt[, -columns_to_drop]

```


I only want the shelters that have complete reports. meaning all 37 months they have data even if they have data for the month in question
```{r}
shelter_counts <- adopt_subset %>%
  group_by(`Shelter Name`) %>%
  summarize(count = n())

shelters_to_keep <- shelter_counts %>%
  filter(count == 37) %>%
  pull(`Shelter Name`)

completeadopt <- adopt_subset %>%
  filter(`Shelter Name` %in% shelters_to_keep)

```

I want to just have data for a month 2023-07-01
```{r}
adopt_subset1 <- mutate(completeadopt, YEAR = year(ymd(`Report Period Start`)))

adoptJuly2023 <- adopt_subset1 %>%
  filter(`Report Period Start` == ymd("2023-07-01"))

columns_to_drop1 <- c(1, 2)
final1 <- adoptJuly2023[, -columns_to_drop1]

```

I need to flip my data --> nvm 
```{r}

#final <- t(final1)

#colnames(final) <-  final1$'Shelter Name'

#row_to_drop <- 1
#finaladopt <- final[-row_to_drop, ]
```


Table 1
```{r}

table1<- gtsummary::tbl_summary(
  final1,
  by = 'Shelter Name',
  include= c(`Shelter Name`, starts_with('Canine'), YEAR)) |>
	 add_overall(col_label = "**Total**")
	

table1

#| table1: tbl-one
#| tbl-cap: "Table 1: Dog Shelter Statistics"
```


Figure 1:
```{r}
hist(final1$`Canine adoption`, main= "Histogram: Counts of Dog Adoptions")

abline(v = mean(final1$'Canine adoption'), col= 'blue', lwd = 4)

mtext("Shows the distribution of dog adoption counts, the blue line is the MEAN", side = 1, line = 4)

#| Figure1: fig-one
#| fig-cap: "Figure 1: Counts of Dog adoptions"
```

The mean and IQR of number of dogs at the shelter are there because of Owner Surrender is `r inline_text(table1, column = Total, row = "Canine relinquished by owner")`. 

The shelter with the most dogs starting out was LAGRANGE ANIMAL CONTROL CENTER with `r inline_text(table1, column = "LAGRANGE ANIMAL CONTROL CENTER, CITY OF" row = "Canine starting animal count"`. 

As you can see in @tbl-one there are 81 shelters with complete reporting data.  
The reporting periods were originally by month over ~3 years. Now it is just counts for the different shelters over 1 month period - the most recent month of July.

My function to do something with the data. 
```{r}
#if numbers are greater then 5 say yes if not than say no 


cpfunc1 <- function(data, row_name) {
  rowvalue <- data[[row_name]]
  if (all(rowvalue >= 5)) {
    return('yes')
  } else {
    return('no')
  }
}

cpfunc1(final1, 'Canine adoption')
```

Table 2: Regression ** this isnt working atm 
```{r}
tbl_uvregression(
	final1,
	y= 'Canine adoption',
		include = everything(),
	method = glm(`Canine adoption` ~ ., data = final1, family = "poisson"))

#because I have counts- I am using a poisson regression model 
poisson_model <- glm(`Canine adoption` ~ ., data = final1, family = "poisson")

# Print a summary of the Poisson regression model
summary(poisson_model)

#fit the model using gtsummary package
tbl <- tbl_uvregression(final1,
  models = poisson_model,
  exponentiate = TRUE
)

# Print the table
tbl

#trying again new way
poisson_method <- function(formula, data) {
  glm(formula, data = data, family = "poisson")
}

# Create a table summarizing the Poisson regression results
tbl <- tbl_uvregression(
  method = poisson_method,
  y = `Canine adoption`,
  include = starts_with('Canine'),
  data = final1,
  exponentiate = TRUE,
  tidy_fun = broom.helpers::tidy_parameters
)
```


```{r}
